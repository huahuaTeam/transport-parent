<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style type="text/css">
    #allmap {
        width: 100%;
        height: 650px;
        overflow: hidden;
        margin: 0;
        font-family: "微软雅黑";
    }
</style>
<body>

<td>
    <div id="allmap"></div>
</td>

<script
        src="/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=A1LU7iHS0avqQwPLAxbhKn0UYSQCuRVH"></script>
<!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=7d9fbeb43e975cd1e9477a7e5d5e192a"></script>-->

<script type="text/javascript">
    // 百度地图API功能
    var json_data;
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(116.404, 39.915);
    map.centerAndZoom(point, 5);
    map.enableScrollWheelZoom(); //启用滚轮放大缩小，默认禁用
    map.enableContinuousZoom(); //启用地图惯性拖拽，默认禁用

    var pointArray = new Array();
    var opts = {
        width : 250,     // 信息窗口宽度
        height: 80,     // 信息窗口高度
        title : "" , // 信息窗口标题
        enableMessage:true//设置允许信息窗发送短息
    };
    $(function(){
        $.ajax({
            url:"storeManagementMap.do",
            type:"post",
            dataType:"json",
            success:function(data){
                json_data = data.list;
                for(var i=0;i<json_data.length;i++){
                    var marker = new BMap.Marker(new BMap.Point(json_data[i][0], json_data[i][1])); // 创建点
                    map.addOverlay(marker);    //增加点
                    pointArray[i] = new BMap.Point(json_data[i][0], json_data[i][1]);
                    var content = json_data[i][2];
                    addClickHandler(content,marker);
                }
                //让所有点在视野范围内
                map.setViewport(pointArray);
            }
        })
    })
    function addClickHandler(content,marker){
        marker.addEventListener("click",function(e){
            openInfo(content,e)}
        );
    }
    function openInfo(content,e){
        var p = e.target;
        var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
        var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象
        map.openInfoWindow(infoWindow,point); //开启信息窗口
    }
</script>
</body>
</html>